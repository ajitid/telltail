<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Telltail</title>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- styles generated by dropping this html code into https://play.tailwindcss.com/ -->
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <style>
      :root {
        font-family: "Inter", sans-serif;
      }

      @supports (font-variation-settings: normal) {
        :root {
          font-family: "Inter var", sans-serif;
        }
      }
    </style>
  </head>

  <body class="bg-gray-100">
    <div class="container mx-auto px-3 py-6">
      <!-- <img src="/static/wifi.svg" alt="Logo"  /> -->
      <!-- remove wifi.svg from static/ if you're removing it from here too -->
      <h1 class="font-bold text-4xl mb-4">Telltail</h1>
      <input
        type="text"
        value="{{.Text}}"
        id="text"
        class="px-2 py-1 rounded-md border-2"
      />
      <button
        type="button"
        id="copy"
        class="ml-2 px-2 py-1 bg-sky-700 text-white rounded-md shadow"
      >
        Copy
      </button>
      <a
        id="open-link"
        href=""
        class="ml-2 text-sky-900 hidden"
        target="_blank"
        rel="noreferrer"
      >
        <span class="underline">Open link</span>â†—
      </a>
    </div>
    <script type="text/javascript">
      function debounce(func, timeout = 300) {
        let timer;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(() => {
            func.apply(this, args);
          }, timeout);
        };
      }

      const textEl = document.querySelector("#text");
      const openLinkEl = document.querySelector("#open-link");

      // check how browsers handle opening multiple links simultaneously
      // if it fails:
      // - split('\n') and only open the first link, or
      // - check if ananto's linkify can be used to recognize and list links

      function checkAndShowOpenLinkButton(text) {
        try {
          new URL(textEl.value);
          openLinkEl.href = textEl.value;
          openLinkEl.classList.remove("hidden");
        } catch {
          openLinkEl.href = "";
          openLinkEl.classList.add("hidden");
        }
      }
      checkAndShowOpenLinkButton();

      textEl.addEventListener(
        "input",
        debounce((ev) => {
          const text = ev.target.value;
          if (text === "") return;
          fetch("/set", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              text,
              device: "unknown",
            }),
          });

          checkAndShowOpenLinkButton();
        })
      );

      document.querySelector("#copy").addEventListener("click", () => {
        navigator.clipboard.writeText(textEl.value);
      });
    </script>
  </body>
</html>
